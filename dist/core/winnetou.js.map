{
  "version": 3,
  "sources": ["../../src/core/winnetou.ts"],
  "sourcesContent": ["interface MutableSubscriber {\r\n  pureId: string;\r\n  method: any;\r\n  elements: any;\r\n  options: any;\r\n}\r\n\r\nclass Winnetou_ {\r\n  public constructoId: number = 0;\r\n  protected mutable: Record<string, any> = {};\r\n  public usingMutable: Record<string, MutableSubscriber[]> = {};\r\n  private storedEvents: any[] = [];\r\n  public strings: Record<string, any> = {};\r\n  private observer: MutationObserver | null = null;\r\n\r\n  constructor() {}\r\n\r\n  setMutable(\r\n    mutable: string,\r\n    value: any,\r\n    localStorage?: boolean | \"notPersistent\"\r\n  ): void {\r\n    if (localStorage !== false && localStorage !== \"notPersistent\") {\r\n      window.localStorage.setItem(`mutable_${mutable}`, value);\r\n    }\r\n\r\n    if (localStorage === false || localStorage === \"notPersistent\") {\r\n      this.mutable[mutable] = value;\r\n    }\r\n\r\n    if (this.usingMutable[mutable]) {\r\n      const tmpArr = this.usingMutable[mutable];\r\n      this.usingMutable[mutable] = [];\r\n\r\n      tmpArr.forEach(item => {\r\n        const old_ = document.getElementById(item.pureId);\r\n        if (old_ == null) return;\r\n\r\n        const new_ = document\r\n          .createRange()\r\n          .createContextualFragment(\r\n            new item.method(item.elements, item.options).constructoString()\r\n          );\r\n\r\n        this.replace(new_, old_);\r\n      });\r\n    }\r\n  }\r\n\r\n  initMutable(value: any): string {\r\n    const name = (new Date().getMilliseconds() * Math.random() * 10000).toFixed(\r\n      0\r\n    );\r\n    this.setMutable(name, value, \"notPersistent\");\r\n    return name;\r\n  }\r\n\r\n  setMutableNotPersistent(mutable: string, value: any): void {\r\n    this.setMutable(mutable, value, \"notPersistent\");\r\n  }\r\n\r\n  getMutable(mutable: string): string | null {\r\n    if (\r\n      window.localStorage.getItem(`mutable_${mutable}`) ||\r\n      window.localStorage.getItem(`mutable_${mutable}`) === \"\"\r\n    ) {\r\n      return window.localStorage.getItem(`mutable_${mutable}`);\r\n    } else if (this.mutable[mutable] || this.mutable[mutable] === \"\") {\r\n      return this.mutable[mutable];\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  mutations = {\r\n    start: (): boolean => {\r\n      if (this.observer) return false;\r\n      this.observer = new MutationObserver(\r\n        (mutationsArray: MutationRecord[]) => {\r\n          try {\r\n            mutationsArray.forEach((mutationRecord: MutationRecord) => {\r\n              mutationRecord.removedNodes.forEach((removedNode: Node) => {\r\n                const removedId =\r\n                  removedNode instanceof Element ? removedNode.id : null;\r\n                const appElement = document.getElementById(\"app\");\r\n                if (appElement) {\r\n                  appElement.dispatchEvent(\r\n                    new CustomEvent(\"constructoRemoved\", {\r\n                      detail: { removedId },\r\n                    })\r\n                  );\r\n                }\r\n              });\r\n            });\r\n          } catch (e) {}\r\n        }\r\n      );\r\n      this.observer.disconnect();\r\n      const appElement = document.getElementById(\"app\");\r\n      if (appElement) {\r\n        this.observer.observe(appElement, {\r\n          childList: true,\r\n          subtree: true,\r\n        });\r\n      }\r\n      return true;\r\n    },\r\n\r\n    onRemove: (id: string, callback: () => void): boolean => {\r\n      const controller = new AbortController();\r\n      const signal = controller.signal;\r\n      const appElement = document.getElementById(\"app\");\r\n      if (appElement) {\r\n        appElement.addEventListener(\r\n          \"constructoRemoved\",\r\n          (data: Event) => {\r\n            if (data instanceof CustomEvent) {\r\n              if (id === data.detail.removedId) {\r\n                callback();\r\n                controller.abort();\r\n              }\r\n            }\r\n          },\r\n          {\r\n            signal,\r\n          }\r\n        );\r\n      }\r\n      return true;\r\n    },\r\n\r\n    destroy: (): void => {\r\n      setTimeout(() => {\r\n        if (this.observer) {\r\n          this.observer.disconnect();\r\n          this.observer = null;\r\n        }\r\n      }, 100);\r\n    },\r\n  };\r\n\r\n  replace(new_: DocumentFragment, old_: HTMLElement): void {\r\n    if (old_ && old_.parentNode) {\r\n      const ele_ = old_.parentNode;\r\n      ele_.replaceChild(new_, old_);\r\n    }\r\n  }\r\n\r\n  fx(function_: Function, ...args: any[]): string {\r\n    const name =\r\n      \"winnetouFx\" +\r\n      (new Date().getMilliseconds() * Math.random() * 10000).toFixed(0);\r\n    (window as any)[name] = function_;\r\n    return `${name}(${args\r\n      .map(x => (x === \"this\" ? `this` : `'${x}'`))\r\n      .join(\",\")})`;\r\n  }\r\n}\r\n\r\nexport const Winnetou = new Winnetou_();\r\nexport const W = Winnetou;\r\nexport const Win = Winnetou;\r\n"],
  "mappings": "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",
  "names": ["appElement"]
}
